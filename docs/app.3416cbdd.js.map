{"version":3,"sources":["../node_modules/canvas-toBlob/canvas-toBlob.js","../node_modules/file-saver/FileSaver.js","../src/icons.js","../src/index.js","app.js"],"names":["saveAs","view","navigator","test","userAgent","doc","document","get_URL","URL","webkitURL","save_link","createElementNS","can_use_save_link","is_safari","HTMLElement","safari","is_chrome_ios","throw_outside","ex","setImmediate","setTimeout","revoke","file","revokeObjectURL","remove","auto_bom","blob","type","Blob","String","fromCharCode","FileSaver","name","no_auto_bom","filesaver","object_url","force","dispatch_all","event_types","event","i","concat","length","listener","call","dispatch","split","readyState","INIT","createObjectURL","node","href","download","MouseEvent","dispatchEvent","DONE","FileReader","reader","onloadend","url","result","replace","open","location","undefined","readAsDataURL","fs_error","FS_proto","prototype","msSaveOrOpenBlob","abort","WRITING","error","onwritestart","onprogress","onwrite","onabort","onerror","onwriteend","self","window","content","module","exports","define","amd","Icons","ExportControl","options","Object","assign","dpi","attribution","textFont","map","container","createElement","className","btn","setAttribute","innerHTML","icons","appendChild","addEventListener","actualPixelRatio","devicePixelRatio","defineProperty","get","_loading","loading","_container","body","width","getContainer","offsetWidth","height","offsetHeight","bottomRight","unproject","toArray","setStyles","visibility","position","top","bottom","fontFamily","style","glyphManager","localIdeographFontFamily","_map","mapboxgl","tilecloud","Map","center","getCenter","zoom","getZoom","bearing","getBearing","pitch","getPitch","getStyle","hash","preserveDrawingBuffer","interactive","attributionControl","once","geojson","features","geometry","coordinates","properties","text","addSource","data","layers","fonts","getLayoutProperty","id","e","addLayer","getCanvas","toBlob","join","parentNode","removeChild","backgroundColor","zIndex","icon","left","right","margin","element","styles","addControl","NavigationControl","tilecloudMap","querySelector"],"mappings":"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","file":"app.3416cbdd.js","sourceRoot":"../example","sourcesContent":["/* canvas-toBlob.js\n * A canvas.toBlob() implementation.\n * 2016-05-26\n * \n * By Eli Grey, http://eligrey.com and Devin Samarin, https://github.com/eboyjr\n * License: MIT\n *   See https://github.com/eligrey/canvas-toBlob.js/blob/master/LICENSE.md\n */\n\n/*global self */\n/*jslint bitwise: true, regexp: true, confusion: true, es5: true, vars: true, white: true,\n  plusplus: true */\n\n/*! @source http://purl.eligrey.com/github/canvas-toBlob.js/blob/master/canvas-toBlob.js */\n\n(function(view) {\n\"use strict\";\nvar\n\t  Uint8Array = view.Uint8Array\n\t, HTMLCanvasElement = view.HTMLCanvasElement\n\t, canvas_proto = HTMLCanvasElement && HTMLCanvasElement.prototype\n\t, is_base64_regex = /\\s*;\\s*base64\\s*(?:;|$)/i\n\t, to_data_url = \"toDataURL\"\n\t, base64_ranks\n\t, decode_base64 = function(base64) {\n\t\tvar\n\t\t\t  len = base64.length\n\t\t\t, buffer = new Uint8Array(len / 4 * 3 | 0)\n\t\t\t, i = 0\n\t\t\t, outptr = 0\n\t\t\t, last = [0, 0]\n\t\t\t, state = 0\n\t\t\t, save = 0\n\t\t\t, rank\n\t\t\t, code\n\t\t\t, undef\n\t\t;\n\t\twhile (len--) {\n\t\t\tcode = base64.charCodeAt(i++);\n\t\t\trank = base64_ranks[code-43];\n\t\t\tif (rank !== 255 && rank !== undef) {\n\t\t\t\tlast[1] = last[0];\n\t\t\t\tlast[0] = code;\n\t\t\t\tsave = (save << 6) | rank;\n\t\t\t\tstate++;\n\t\t\t\tif (state === 4) {\n\t\t\t\t\tbuffer[outptr++] = save >>> 16;\n\t\t\t\t\tif (last[1] !== 61 /* padding character */) {\n\t\t\t\t\t\tbuffer[outptr++] = save >>> 8;\n\t\t\t\t\t}\n\t\t\t\t\tif (last[0] !== 61 /* padding character */) {\n\t\t\t\t\t\tbuffer[outptr++] = save;\n\t\t\t\t\t}\n\t\t\t\t\tstate = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// 2/3 chance there's going to be some null bytes at the end, but that\n\t\t// doesn't really matter with most image formats.\n\t\t// If it somehow matters for you, truncate the buffer up outptr.\n\t\treturn buffer;\n\t}\n;\nif (Uint8Array) {\n\tbase64_ranks = new Uint8Array([\n\t\t  62, -1, -1, -1, 63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1\n\t\t, -1, -1,  0, -1, -1, -1,  0,  1,  2,  3,  4,  5,  6,  7,  8,  9\n\t\t, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25\n\t\t, -1, -1, -1, -1, -1, -1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35\n\t\t, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51\n\t]);\n}\nif (HTMLCanvasElement && (!canvas_proto.toBlob || !canvas_proto.toBlobHD)) {\n\tif (!canvas_proto.toBlob)\n\tcanvas_proto.toBlob = function(callback, type /*, ...args*/) {\n\t\t  if (!type) {\n\t\t\ttype = \"image/png\";\n\t\t} if (this.mozGetAsFile) {\n\t\t\tcallback(this.mozGetAsFile(\"canvas\", type));\n\t\t\treturn;\n\t\t} if (this.msToBlob && /^\\s*image\\/png\\s*(?:$|;)/i.test(type)) {\n\t\t\tcallback(this.msToBlob());\n\t\t\treturn;\n\t\t}\n\n\t\tvar\n\t\t\t  args = Array.prototype.slice.call(arguments, 1)\n\t\t\t, dataURI = this[to_data_url].apply(this, args)\n\t\t\t, header_end = dataURI.indexOf(\",\")\n\t\t\t, data = dataURI.substring(header_end + 1)\n\t\t\t, is_base64 = is_base64_regex.test(dataURI.substring(0, header_end))\n\t\t\t, blob\n\t\t;\n\t\tif (Blob.fake) {\n\t\t\t// no reason to decode a data: URI that's just going to become a data URI again\n\t\t\tblob = new Blob\n\t\t\tif (is_base64) {\n\t\t\t\tblob.encoding = \"base64\";\n\t\t\t} else {\n\t\t\t\tblob.encoding = \"URI\";\n\t\t\t}\n\t\t\tblob.data = data;\n\t\t\tblob.size = data.length;\n\t\t} else if (Uint8Array) {\n\t\t\tif (is_base64) {\n\t\t\t\tblob = new Blob([decode_base64(data)], {type: type});\n\t\t\t} else {\n\t\t\t\tblob = new Blob([decodeURIComponent(data)], {type: type});\n\t\t\t}\n\t\t}\n\t\tcallback(blob);\n\t};\n\n\tif (!canvas_proto.toBlobHD && canvas_proto.toDataURLHD) {\n\t\tcanvas_proto.toBlobHD = function() {\n\t\t\tto_data_url = \"toDataURLHD\";\n\t\t\tvar blob = this.toBlob();\n\t\t\tto_data_url = \"toDataURL\";\n\t\t\treturn blob;\n\t\t}\n\t} else {\n\t\tcanvas_proto.toBlobHD = canvas_proto.toBlob;\n\t}\n}\n}(typeof self !== \"undefined\" && self || typeof window !== \"undefined\" && window || this.content || this));\n","/* FileSaver.js\n * A saveAs() FileSaver implementation.\n * 1.3.2\n * 2016-06-16 18:25:19\n *\n * By Eli Grey, http://eligrey.com\n * License: MIT\n *   See https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md\n */\n\n/*global self */\n/*jslint bitwise: true, indent: 4, laxbreak: true, laxcomma: true, smarttabs: true, plusplus: true */\n\n/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */\n\nvar saveAs = saveAs || (function(view) {\n\t\"use strict\";\n\t// IE <10 is explicitly unsupported\n\tif (typeof view === \"undefined\" || typeof navigator !== \"undefined\" && /MSIE [1-9]\\./.test(navigator.userAgent)) {\n\t\treturn;\n\t}\n\tvar\n\t\t  doc = view.document\n\t\t  // only get URL when necessary in case Blob.js hasn't overridden it yet\n\t\t, get_URL = function() {\n\t\t\treturn view.URL || view.webkitURL || view;\n\t\t}\n\t\t, save_link = doc.createElementNS(\"http://www.w3.org/1999/xhtml\", \"a\")\n\t\t, can_use_save_link = \"download\" in save_link\n\t\t, click = function(node) {\n\t\t\tvar event = new MouseEvent(\"click\");\n\t\t\tnode.dispatchEvent(event);\n\t\t}\n\t\t, is_safari = /constructor/i.test(view.HTMLElement) || view.safari\n\t\t, is_chrome_ios =/CriOS\\/[\\d]+/.test(navigator.userAgent)\n\t\t, throw_outside = function(ex) {\n\t\t\t(view.setImmediate || view.setTimeout)(function() {\n\t\t\t\tthrow ex;\n\t\t\t}, 0);\n\t\t}\n\t\t, force_saveable_type = \"application/octet-stream\"\n\t\t// the Blob API is fundamentally broken as there is no \"downloadfinished\" event to subscribe to\n\t\t, arbitrary_revoke_timeout = 1000 * 40 // in ms\n\t\t, revoke = function(file) {\n\t\t\tvar revoker = function() {\n\t\t\t\tif (typeof file === \"string\") { // file is an object URL\n\t\t\t\t\tget_URL().revokeObjectURL(file);\n\t\t\t\t} else { // file is a File\n\t\t\t\t\tfile.remove();\n\t\t\t\t}\n\t\t\t};\n\t\t\tsetTimeout(revoker, arbitrary_revoke_timeout);\n\t\t}\n\t\t, dispatch = function(filesaver, event_types, event) {\n\t\t\tevent_types = [].concat(event_types);\n\t\t\tvar i = event_types.length;\n\t\t\twhile (i--) {\n\t\t\t\tvar listener = filesaver[\"on\" + event_types[i]];\n\t\t\t\tif (typeof listener === \"function\") {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlistener.call(filesaver, event || filesaver);\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\tthrow_outside(ex);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t, auto_bom = function(blob) {\n\t\t\t// prepend BOM for UTF-8 XML and text/* types (including HTML)\n\t\t\t// note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF\n\t\t\tif (/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(blob.type)) {\n\t\t\t\treturn new Blob([String.fromCharCode(0xFEFF), blob], {type: blob.type});\n\t\t\t}\n\t\t\treturn blob;\n\t\t}\n\t\t, FileSaver = function(blob, name, no_auto_bom) {\n\t\t\tif (!no_auto_bom) {\n\t\t\t\tblob = auto_bom(blob);\n\t\t\t}\n\t\t\t// First try a.download, then web filesystem, then object URLs\n\t\t\tvar\n\t\t\t\t  filesaver = this\n\t\t\t\t, type = blob.type\n\t\t\t\t, force = type === force_saveable_type\n\t\t\t\t, object_url\n\t\t\t\t, dispatch_all = function() {\n\t\t\t\t\tdispatch(filesaver, \"writestart progress write writeend\".split(\" \"));\n\t\t\t\t}\n\t\t\t\t// on any filesys errors revert to saving with object URLs\n\t\t\t\t, fs_error = function() {\n\t\t\t\t\tif ((is_chrome_ios || (force && is_safari)) && view.FileReader) {\n\t\t\t\t\t\t// Safari doesn't allow downloading of blob urls\n\t\t\t\t\t\tvar reader = new FileReader();\n\t\t\t\t\t\treader.onloadend = function() {\n\t\t\t\t\t\t\tvar url = is_chrome_ios ? reader.result : reader.result.replace(/^data:[^;]*;/, 'data:attachment/file;');\n\t\t\t\t\t\t\tvar popup = view.open(url, '_blank');\n\t\t\t\t\t\t\tif(!popup) view.location.href = url;\n\t\t\t\t\t\t\turl=undefined; // release reference before dispatching\n\t\t\t\t\t\t\tfilesaver.readyState = filesaver.DONE;\n\t\t\t\t\t\t\tdispatch_all();\n\t\t\t\t\t\t};\n\t\t\t\t\t\treader.readAsDataURL(blob);\n\t\t\t\t\t\tfilesaver.readyState = filesaver.INIT;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// don't create more object URLs than needed\n\t\t\t\t\tif (!object_url) {\n\t\t\t\t\t\tobject_url = get_URL().createObjectURL(blob);\n\t\t\t\t\t}\n\t\t\t\t\tif (force) {\n\t\t\t\t\t\tview.location.href = object_url;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar opened = view.open(object_url, \"_blank\");\n\t\t\t\t\t\tif (!opened) {\n\t\t\t\t\t\t\t// Apple does not allow window.open, see https://developer.apple.com/library/safari/documentation/Tools/Conceptual/SafariExtensionGuide/WorkingwithWindowsandTabs/WorkingwithWindowsandTabs.html\n\t\t\t\t\t\t\tview.location.href = object_url;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfilesaver.readyState = filesaver.DONE;\n\t\t\t\t\tdispatch_all();\n\t\t\t\t\trevoke(object_url);\n\t\t\t\t}\n\t\t\t;\n\t\t\tfilesaver.readyState = filesaver.INIT;\n\n\t\t\tif (can_use_save_link) {\n\t\t\t\tobject_url = get_URL().createObjectURL(blob);\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tsave_link.href = object_url;\n\t\t\t\t\tsave_link.download = name;\n\t\t\t\t\tclick(save_link);\n\t\t\t\t\tdispatch_all();\n\t\t\t\t\trevoke(object_url);\n\t\t\t\t\tfilesaver.readyState = filesaver.DONE;\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfs_error();\n\t\t}\n\t\t, FS_proto = FileSaver.prototype\n\t\t, saveAs = function(blob, name, no_auto_bom) {\n\t\t\treturn new FileSaver(blob, name || blob.name || \"download\", no_auto_bom);\n\t\t}\n\t;\n\t// IE 10+ (native saveAs)\n\tif (typeof navigator !== \"undefined\" && navigator.msSaveOrOpenBlob) {\n\t\treturn function(blob, name, no_auto_bom) {\n\t\t\tname = name || blob.name || \"download\";\n\n\t\t\tif (!no_auto_bom) {\n\t\t\t\tblob = auto_bom(blob);\n\t\t\t}\n\t\t\treturn navigator.msSaveOrOpenBlob(blob, name);\n\t\t};\n\t}\n\n\tFS_proto.abort = function(){};\n\tFS_proto.readyState = FS_proto.INIT = 0;\n\tFS_proto.WRITING = 1;\n\tFS_proto.DONE = 2;\n\n\tFS_proto.error =\n\tFS_proto.onwritestart =\n\tFS_proto.onprogress =\n\tFS_proto.onwrite =\n\tFS_proto.onabort =\n\tFS_proto.onerror =\n\tFS_proto.onwriteend =\n\t\tnull;\n\n\treturn saveAs;\n}(\n\t   typeof self !== \"undefined\" && self\n\t|| typeof window !== \"undefined\" && window\n\t|| this.content\n));\n// `self` is undefined in Firefox for Android content script context\n// while `this` is nsIContentFrameMessageManager\n// with an attribute `content` that corresponds to the window\n\nif (typeof module !== \"undefined\" && module.exports) {\n  module.exports.saveAs = saveAs;\n} else if ((typeof define !== \"undefined\" && define !== null) && (define.amd !== null)) {\n  define(\"FileSaver.js\", function() {\n    return saveAs;\n  });\n}\n","const Icons = {}\n\nIcons.loading = `\n  <svg style=\"width: 100%; height: 100%;\" width=\"45\" height=\"45\" viewBox=\"0 0 45 45\" stroke=\"#fff\">\n    <g fill=\"none\" fill-rule=\"evenodd\" transform=\"translate(1 1)\" stroke-width=\"2\">\n      <circle cx=\"22\" cy=\"22\" r=\"6\" stroke-opacity=\"0\">\n        <animate attributeName=\"r\"\n              begin=\"1.5s\" dur=\"3s\"\n              values=\"6;22\"\n              calcMode=\"linear\"\n              repeatCount=\"indefinite\" />\n        <animate attributeName=\"stroke-opacity\"\n              begin=\"1.5s\" dur=\"3s\"\n              values=\"1;0\" calcMode=\"linear\"\n              repeatCount=\"indefinite\" />\n        <animate attributeName=\"stroke-width\"\n              begin=\"1.5s\" dur=\"3s\"\n              values=\"2;0\" calcMode=\"linear\"\n              repeatCount=\"indefinite\" />\n      </circle>\n      <circle cx=\"22\" cy=\"22\" r=\"6\" stroke-opacity=\"0\">\n        <animate attributeName=\"r\"\n              begin=\"3s\" dur=\"3s\"\n              values=\"6;22\"\n              calcMode=\"linear\"\n              repeatCount=\"indefinite\" />\n        <animate attributeName=\"stroke-opacity\"\n              begin=\"3s\" dur=\"3s\"\n              values=\"1;0\" calcMode=\"linear\"\n              repeatCount=\"indefinite\" />\n        <animate attributeName=\"stroke-width\"\n              begin=\"3s\" dur=\"3s\"\n              values=\"2;0\" calcMode=\"linear\"\n              repeatCount=\"indefinite\" />\n      </circle>\n      <circle cx=\"22\" cy=\"22\" r=\"8\">\n        <animate attributeName=\"r\"\n              begin=\"0s\" dur=\"1.5s\"\n              values=\"6;1;2;3;4;5;6\"\n              calcMode=\"linear\"\n              repeatCount=\"indefinite\" />\n      </circle>\n    </g>\n  </svg>\n  `\n\n\nIcons.download = `\n  <svg height=\"19px\" viewBox=\"0 0 14 19\" width=\"14px\" xmlns=\"http://www.w3.org/2000/svg\">\n    <title/><desc/><defs/>\n    <g fill=\"none\" fill-rule=\"evenodd\" id=\"Page-1\" stroke=\"none\" stroke-width=\"1\">\n      <g fill=\"#000000\" id=\"Core\" transform=\"translate(-383.000000, -213.000000)\">\n        <g id=\"file-download\" transform=\"translate(383.000000, 213.500000)\">\n          <path d=\"M14,6 L10,6 L10,0 L4,0 L4,6 L0,6 L7,13 L14,6 L14,6 Z M0,15 L0,17 L14,17 L14,15 L0,15 L0,15 Z\" id=\"Shape\"/>\n        </g>\n      </g>\n    </g>\n  </svg>\n  `\n\nexport default Icons\n","import 'canvas-toBlob'\nimport FileSaver from 'file-saver'\nimport icons from './icons'\n\nclass ExportControl {\n\n  constructor(options = {}) {\n    this.options = Object.assign({\n        dpi: 300,\n        attribution: \"Â© OpenStreetMap Contributors\",\n        textFont: [],\n      }, options\n    )\n  }\n\n  onAdd(map) {\n    this.container = document.createElement('div')\n    this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group'\n\n    const btn = document.createElement('button')\n    btn.className = 'mapboxgl-ctrl-icon mapbox-gl-download'\n    btn.type = \"button\"\n    btn.setAttribute(\"aria-label\", \"Download\")\n    btn.innerHTML = icons.download\n\n    this.container.appendChild(btn)\n\n    btn.addEventListener('click', () => {\n      const actualPixelRatio = window.devicePixelRatio;\n      Object.defineProperty(window, 'devicePixelRatio', {\n        get: () => this.options.dpi / 96\n      });\n\n      const _loading = this.loading()\n\n      const _container = document.createElement('div')\n      document.body.appendChild(_container)\n\n      const width = map.getContainer().offsetWidth\n      const height = map.getContainer().offsetHeight\n      const bottomRight = map.unproject([width, height]).toArray()\n\n      this.setStyles(_container, {\n        visibility: \"hidden\",\n        position: \"absolute\",\n        top: 0,\n        bottom: 0,\n        width: `${width}px`,\n        height: `${height}px`,\n      })\n\n      let fontFamily = []\n      if (map.style.glyphManager && map.style.glyphManager.localIdeographFontFamily) {\n        fontFamily = map.style.glyphManager.localIdeographFontFamily\n      }\n\n      let mbgl;\n      if ('undefined' === typeof mapboxgl) {\n        mbgl = tilecloud.mapboxgl.Map\n      } else {\n        mbgl = mapboxgl.Map\n      }\n\n      const _map = new mbgl({\n        container: _container,\n        center: map.getCenter(),\n        zoom: map.getZoom(),\n        bearing: map.getBearing(),\n        pitch: map.getPitch(),\n        style: map.getStyle(),\n        localIdeographFontFamily: fontFamily,\n        hash: false,\n        preserveDrawingBuffer: true,\n        interactive: false,\n        attributionControl: false,\n      })\n\n      _map.once('load', () => {\n        const geojson = {\n          type: 'FeatureCollection',\n          features: [{\n            type: 'Feature',\n            geometry: {\n              type: 'Point',\n              coordinates: bottomRight\n            },\n            properties: {\n              text: this.options.attribution\n            }\n          }]\n        };\n\n        _map.addSource(\"attribution-for-image\", {\n          type: \"geojson\",\n          data: geojson\n        })\n\n        let textFont = []\n        if (this.options.textFont.length) {\n          textFont = this.options.textFont\n        } else {\n          const layers = map.getStyle().layers\n          for (let i = 0; i < layers.length; i++) {\n            try {\n              const fonts = map.getLayoutProperty(layers[i].id, 'text-font')\n              if (fonts && fonts.length) {\n                textFont = fonts\n                break;\n              }\n            } catch (e) {\n              // Nothing to do.\n            }\n          }\n        }\n\n        _map.addLayer({\n          \"id\": \"markers\",\n          \"type\": \"symbol\",\n          \"source\": \"attribution-for-image\",\n          \"paint\": {\n            \"text-color\": \"#000000\",\n            \"text-halo-color\": \"rgba(255, 255, 255, 1)\",\n            \"text-halo-width\": 2,\n          },\n          \"layout\": {\n            \"text-field\": \"{text}\",\n            \"text-font\": textFont,\n            \"text-size\": 18,\n            \"text-anchor\": \"bottom-right\",\n            \"text-max-width\": 28,\n            \"text-offset\": [-0.5, -0.5],\n            \"text-allow-overlap\": true,\n          }\n        });\n\n        setTimeout(() => {\n          _map.getCanvas().toBlob((blob) => {\n            FileSaver.saveAs(blob, `${_map.getCenter().toArray().join('-')}.png`)\n            _map.remove()\n            _container.parentNode.removeChild(_container)\n            _loading.parentNode.removeChild(_loading)\n            Object.defineProperty(window, 'devicePixelRatio', {\n              get: () => actualPixelRatio\n            });\n          })\n        }, 3000)\n      })\n    })\n\n    return this.container;\n  }\n\n  onRemove() {\n    this.container.parentNode.removeChild(this.container)\n  }\n\n  loading() {\n    const container = document.createElement('div')\n    document.body.appendChild(container)\n\n    this.setStyles(container, {\n      position: \"absolute\",\n      top: 0,\n      bottom: 0,\n      width: \"100%\",\n      backgroundColor: \"rgba(0, 0, 0, 0.6)\",\n      zIndex: 9999,\n    })\n\n    const icon = document.createElement('div')\n    icon.innerHTML = icons.loading\n\n    this.setStyles(icon, {\n      position: \"absolute\",\n      top: 0,\n      bottom: 0,\n      left: 0,\n      right: 0,\n      zIndex: 9999,\n      margin: \"auto\",\n      width: \"120px\",\n      height: \"120px\",\n    })\n\n    container.appendChild(icon)\n\n    return container;\n  }\n\n  setStyles(element, styles) {\n    for (const style in styles) {\n      element.style[style] = styles[style]\n    }\n  }\n}\n\nexport default ExportControl\n","import ExportControl from '..'\n\nconst map = new mapboxgl.Map({\n  container: 'map',\n  style: 'https://tilecloud.github.io/tiny-tileserver/style.json',\n  attributionControl: true,\n  hash: true,\n  localIdeographFontFamily: ['sans-serif']\n});\n\nmap.addControl(new mapboxgl.NavigationControl())\nmap.addControl(new ExportControl({\n  dpi: 300,\n}))\n\nconst tilecloudMap = new tilecloud.Map(document.querySelector('#tilecloud-custom'))\ntilecloudMap.addControl(new ExportControl({\n  dpi: 300,\n}))\n"]}